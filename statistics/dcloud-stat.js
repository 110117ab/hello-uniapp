!function(){"use strict";var e={onLaunch:function(){},onHide:function(){},onShow:function(){}};function a(t,e,a){if(t[e]){var s=t[e];t[e]=function(t){s.call(this,t),a.call(this,t,e)}}else t[e]=function(t){a.call(this,t,e)}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}var o=require("crypto");function u(t){var e=Object.keys(t).sort(),a={},s="";for(var i in e)a[e[i]]=t[e[i]],s+=e[i]+"="+t[e[i]]+"&";var n=s.substr(0,s.length-1);return s=s.substr(0,s.length-1)+"&key=qkTHEIegZGcL5iy3",{sign:o.createHash("md5").update(s).digest("hex"),options:n}}function c(t){var e=new Date;return e=e.getTime()/1e3,parseInt(e)}function l(){var t="";switch(process.env.VUE_APP_PLATFORM){case"app-plus":t="n";break;case"h5":t="h5";break;case"mp-weixin":t="wx";break;case"mp-alipay":t="ali";break;case"mp-baidu":t="bd";break;case"mp-toutiao":t="tt";break;case"mp-qq":t="qq"}return t}function h(){var t=(new Date).getTime();return uni.setStorageSync("Set__First__Time",t),uni.removeStorageSync("Set__Last__Time"),t}function f(){var t=(new Date).getTime();return uni.setStorageSync("Set__Last__Time",t),t}function p(t){var e=uni.getStorageSync("Set__First__Time")||0,a=(uni.getStorageSync("Set__Last__Time")||0)-e;return a=(a=parseInt(a/1e3))<1?1:a,"app"===t?{residenceTime:a,overtime:300<a}:"page"!==t?{residenceTime:a}:{residenceTime:a,overtime:1800<a}}function v(t){return"bd"===l()?t.$mp&&t.$mp.page.is:t.$mp&&t.$mp.page.route}function g(t){if("string"==typeof t)return{check:255<t.length,msg:" 的长度超过 255 个字符"};if("object"!==r(t))return!1;var e=!1;for(var a in t)if("string"!=typeof t[a]){e=!0;break}return{check:e,msg:" 对象的值只能为 string 类型"}}function _(t){return!!("page"===t.mpType||t.$mp&&"page"===t.$mp.mpType)}function d(t){L.report(t,this)}function m(t){L.show(this)}function y(t){L.hide(this)}function D(){L.hide(this)}function S(t){L.error(t)}var t,k,w=require("./dcloud-stat-config.js"),b=((t=uni.getStorageSync("uuid"))&&36===t.length||(t=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^(void 0!==o&&o.getRandomValues?o.getRandomValues(new Uint8Array(1))[0]:Math.floor(255*Math.random()))&15>>t/4).toString(16)}),uni.setStorageSync("uuid",t)),t),T=l(),q="n"===l()?plus.runtime.version:"",R=(k="","n"===l()&&(k=plus.runtime.channel),k),E=c(),H=uni.getSystemInfoSync(),V=new(function(){function t(){s(this,t),this.self="",this.retry=0,this.scene=0,this.platform="",this.__licationHide=!1,this.__licationShow=!1,this.lastPageRoute="",this.nowPageRoute="",this.statData={uuid:b,ut:T,ak:w.app_key,usv:"0.0.2",v:q,ch:R,cn:"",pn:"",ct:"",t:E,tt:""}}return n(t,[{key:"_applicationShow",value:function(){if(this.__licationHide){if(f(),p("app").overtime){var t={path:this.lastPageRoute,scene:this.statData.sc};this._sendReportRequest(t)}this.__licationShow=!0,this.__licationHide=!1}}},{key:"_applicationHide",value:function(t){this.__licationHide=!0,f();var e=p();h(),this._sendHideRequest({urlref:this.lastPageRoute,urlref_ts:e.residenceTime})}},{key:"_pageShow",value:function(t){var e=v(t);if(this.__licationShow)return this.__licationShow=!1,h(),void(this.lastPageRoute=e);f();var a=p("page");if(h(),a.overtime){var s={path:this.lastPageRoute,scene:this.statData.sc};this._sendReportRequest(s)}else this._sendPageRequest({url:e,urlref:this.lastPageRoute,urlref_ts:a.residenceTime});this.lastPageRoute=e}},{key:"_pageHide",value:function(t){this.__licationHide}},{key:"_sendReportRequest",value:function(t,e){this.statData.lt="1",this.statData.url=t.path,this.statData.t=c(),this.statData.sc=function(t){var e=l(),a="";return t||("wx"===e&&(a=uni.getLaunchOptionsSync().scene),a)}(t.scene),this.statData.fvts=function(t){var e=uni.getStorageSync("First__Visit__Time"),a=0;return e?a=e:(a=c(),uni.setStorageSync("First__Visit__Time",a),uni.removeStorageSync("Last__Visit__Time")),a}(),this.statData.lvts=function(t){var e=uni.getStorageSync("Last__Visit__Time"),a=0;return a=e||"",uni.setStorageSync("Last__Visit__Time",c()),a}(),this.statData.tvc=function(){var t=uni.getStorageSync("Total__Visit__Count"),e=1;return t&&(e=t,e++),uni.setStorageSync("Total__Visit__Count",e),e}(),this.getDeviceInfo()}},{key:"_sendPageRequest",value:function(t){var e=t.url,a=t.urlref,s=t.urlref_ts,i={ak:this.statData.ak,uuid:this.statData.uuid,lt:"11",ut:this.statData.ut,url:e,tt:"",urlref:a,urlref_ts:s,ch:this.statData.ch,usv:this.statData.usv,t:c(),p:this.statData.p};this.request(i)}},{key:"_sendHideRequest",value:function(t){var e=t.urlref,a=t.urlref_ts,s={ak:this.statData.ak,uuid:this.statData.uuid,lt:"3",ut:this.statData.ut,urlref:e,urlref_ts:a,ch:this.statData.ch,usv:this.statData.usv,t:c(),p:this.statData.p};this.request(s)}},{key:"getDeviceInfo",value:function(){process.env.NODE_ENV;var t=H.platform;this.platform=t,this.statData.p="android"===H.platform?"a":"i",this.statData.brand=H.brand||"",this.statData.md=H.model,this.statData.sv=H.system.replace(/(Android|iOS)\s/,""),this.statData.mpsdk=H.SDKVersion||"",this.statData.mpv=H.version||"",this.statData.lang=H.language,this.statData.pr=H.pixelRatio,this.statData.ww=H.windowWidth,this.statData.wh=H.windowHeight,this.statData.sw=H.screenWidth,this.statData.sh=H.screenHeight,this.getNetworkInfo()}},{key:"getNetworkInfo",value:function(){var e=this;uni.getNetworkType({success:function(t){e.statData.net=t.networkType,e.getLocation()}})}},{key:"getLocation",value:function(){var e=this;w.getLocation?uni.getLocation({type:"wgs84",geocode:!0,success:function(t){t.address&&(e.statData.cn=t.address.country,e.statData.pn=t.address.province,e.statData.ct=t.address.city),e.statData.lat=t.latitude,e.statData.lng=t.longitude,e.request(e.statData)}}):(this.statData.lat=0,this.statData.lng=0,this.request(this.statData))}},{key:"request",value:function(e){var a=this;delete e.si,e.si=u(e).sign,"h5"!==e.ut?uni.request({url:"https://stream.dcloud.net.cn/uni/stat",method:"GET",data:e,success:function(t){"development"===process.env.NODE_ENV&&console.log("stat request success")},fail:function(t){"development"===process.env.NODE_ENV&&console.log("stat request fail",t),++a.retry<3&&setTimeout(function(){a.request(e)},500)}}):this.imageRequest(e)}},{key:"imageRequest",value:function(t){var e=new Image,a=u(function(t){var e={};for(var a in t)e[a]=encodeURIComponent(t[a]);return e}(t)).options;e.src="https://stream.dcloud.net.cn/uni/stat.gif?"+a}}]),t}()),L=new(function(){function t(){s(this,t)}return n(t,[{key:"report",value:function(t,e){V.self=e,"development"===process.env.NODE_ENV&&console.log("report init"),V.__licationShow=!0,V._sendReportRequest(t,!0)}},{key:"show",value:function(t){V.self=t,_(t)?V._pageShow(t):V._applicationShow(t)}},{key:"hide",value:function(t){V.self=t,_(t)?V._pageHide(t):V._applicationHide(t)}},{key:"error",value:function(t){if("devtools"!==V.platform){var e="";e="h5"===T?t.toString():JSON.stringify(t).substr(0,255).replace(/\\n/g," ").replace(/\s+/g," ").replace(/\\/g,"").replace(/\"/g,"'");var a={ak:V.statData.ak,uuid:V.statData.uuid,lt:"31",ut:V.statData.ut,ch:V.statData.ch,mpsdk:V.statData.mpsdk,mpv:V.statData.mpv,v:V.statData.v,em:e,usv:V.statData.usv,t:c(),p:V.statData.p};V.request(a)}else"development"===process.env.NODE_ENV&&console.info("当前运行环境为开发者工具，不上报数据。")}},{key:"sendEvent",value:function(t,e){var a=g(t),s=g(e);if(e)if(a.check)console.error("自定义事件的 key"+a.msg);else if(s.check)console.error("自定义事件的 value"+s.msg);else{var i=v(V.self),n={ak:V.statData.ak,uuid:V.statData.uuid,lt:"21",ut:V.statData.ut,url:i,ch:V.statData.ch,e_n:t,e_v:"object"===r(e)?JSON.stringify(e):e.toString(),usv:V.statData.usv,t:c(),p:V.statData.p};V.request(n)}else console.error("自定义事件 value 不能为空")}}]),t}());module.exports.init=function(t){a(e,"onLaunch",d),a(e,"onShow",m),a(e,"onHide",y),a(e,"onUnload",D),a(e,"onError",S),t.mixin(e),t.prototype.$stat={sendEvent:L.sendEvent}}}();
